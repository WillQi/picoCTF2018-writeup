# A Simple Question

**Points:** 650

**Description**
> There is a website running at `http://2018shell1.picoctf.com:28120` ([link](http://2018shell1.picoctf.com:28120)). Try to see if you can answer its question.

## Solution

If we navigate to the [site](http://2018shell1.picoctf.com:28120) and view the html code, we can see that we can find the source code of the website at [answer2.phps](http://2018shell1.picoctf.com:28120/answers2.phps). 

```php
<?php
  include "config.php";
  ini_set('error_reporting', E_ALL);
  ini_set('display_errors', 'On');

  $answer = $_POST["answer"];
  $debug = $_POST["debug"];
  $query = "SELECT * FROM answers WHERE answer='$answer'";
  echo "<pre>";
  echo "SQL query: ", htmlspecialchars($query), "\n";
  echo "</pre>";
?>
<?php
  $con = new SQLite3($database_file);
  $result = $con->query($query);

  $row = $result->fetchArray();
  if($answer == $CANARY)  {
    echo "<h1>Perfect!</h1>";
    echo "<p>Your flag is: $FLAG</p>";
  }
  elseif ($row) {
    echo "<h1>You are so close.</h1>";
  } else {
    echo "<h1>Wrong.</h1>";
  }
?>
```

From this we can see it does not properly escape our input. We can inject SQL into this. Let's inject `' OR 1=1 OR '` as our answer, we get returned the text "You are so close."

Ok, so the problem is that to echo the flag, it checks that our answer is equal to `$CANARY`. Our SQL injection will only return if it found a row in the database. What if we used the `LIKE` keyword in SQL to see if we find the first character of `$CANARY`?
If we could construct our query to be `SELECT * FROM answers WHERE answer='$answer' OR '1' AND answer LIKE 'a%s'`, we could essentially keep changing "a" to every character to see if we got "You are so close." or "Wrong." as a response. If we get "You are so close." Then we found the first character. To find the second character, we would want a query like `SELECT * FROM answers WHERE answer='$answer' OR '1' AND answer LIKE 'ab%s'`. (assuming "a" is the first character) We would change "b" to every character until we get a "You are so close." response, and we'd do the same for the third character.

Let's input `' OR '1' AND answer LIKE 'a%s` as our answer.

We get the response that it's wrong. But that's ok. There are plenty of other characters we have to test. You could either go through them all the characters, or construct a [script](./solution.js) to do it for you.

You will eventually be unable to find any characters to append and end up with your input being something like `' OR '1' AND answer LIKE '41ANDSIXSIXTHS%s`. `41ANDSIXSIXTHS` is the answer, yet when we try to input it, it still says it's wrong. Don't end up like me who spent an hour just to figure out that `$answer == $CANARY` is case sensitive. There doesn't seem to be any hint about how it wants us to input our answer, I assumed that every word would start with a captial. And it worked. `41AndSixSixths` is your answer, input that and you will get your flag.

The flag is `picoCTF{qu3stions_ar3_h4rd_73139cd9}`